{"version":3,"file":"overlay.esm.js","sources":["../src/api.js","../src/events.js","../src/main.js"],"sourcesContent":["'use strict';\r\n\r\n/**\r\n * Ported and modified from ngld/OverlayPlugin\r\n * MIT License\r\n */\r\n\r\nexport default class RawAPI {\r\n  /**\r\n   * Init API\r\n   * @constructor\r\n   * @param {String} queue - Message queue before OverlayPluginApi is ready\r\n   * @param {Boolean} apiStatus - OverlayPluginApi init status\r\n   * @param {Object} subscribers - All subscribers for events emitted by OverlayPluginApi\r\n   */\r\n  constructor() {\r\n    this.queue = [];\r\n    this.apiStatus = false;\r\n    this.subscribers = {}; // { eventName: callbackFunc }\r\n    // Check if in WebSocket mode\r\n    this.wsURL = /[\\?&]OVERLAY_WS=([^&]+)/.exec(window.location.href);\r\n    if (this.wsURL) {\r\n      this.ws = null;\r\n      this.responsePromises = {};\r\n      this.initWS();\r\n    } else {\r\n      this.initAPI();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Init OverlayPluginApi connection\r\n   */\r\n  initAPI() {\r\n    if (!window.OverlayPluginApi || !window.OverlayPluginApi.ready) {\r\n      setTimeout(this.initAPI, 200);\r\n      return;\r\n    }\r\n    // API loaded\r\n    this.apiStatus = true;\r\n    // Bind `this` for callback function called by OverlayAPI, otherwist it will turn to `undefined`\r\n    window.__OverlayCallback = this.triggerEvent.bind(this);\r\n    // Send all messages in queue to OverlayPluginApi\r\n    while (this.queue.length > 0) {\r\n      let { obj, cb } = this.queue.shift();\r\n      window.OverlayPluginApi.callHandler(JSON.stringify(obj), cb);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Init WebSocket connection\r\n   */\r\n  initWS() {\r\n    this.ws = new WebSocket(this.wsURL[1]);\r\n    // Log error\r\n    this.ws.addEventListener('error', (e) => {\r\n      console.error(e);\r\n    });\r\n    // Successfully connected WebSocket\r\n    this.ws.addEventListener('open', () => {\r\n      console.info('[API] WebSocket connected');\r\n      this.apiStatus = true;\r\n      while (this.queue.length > 0) {\r\n        let msg = this.queue.shift();\r\n        this.sendMessage(msg);\r\n      }\r\n    });\r\n    // On message loaded from WebSocket\r\n    this.ws.addEventListener('message', (msg) => {\r\n      try {\r\n        msg = JSON.parse(msg.data);\r\n      } catch (e) {\r\n        console.error('[API] WebSocket invalid message received: ', msg, e);\r\n        return;\r\n      }\r\n      if (msg.rseq !== undefined && this.responsePromises[msg.rseq]) {\r\n        this.responsePromises[msg.rseq](msg);\r\n        delete this.responsePromises[msg.rseq];\r\n      } else {\r\n        this.triggerEvent(msg);\r\n      }\r\n    });\r\n    // Connection failed\r\n    this.ws.addEventListener('close', () => {\r\n      this.apiStatus = false;\r\n      console.info('[API] WebSocket trying to reconnect...');\r\n      // Don't spam the server with retries\r\n      setTimeout(() => {\r\n        this.initWS();\r\n      }, 200);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Send message to OverlayPluginApi or push into queue before its init\r\n   * @param {Object} obj - Object to send\r\n   * @param {Function} cb - Callback function\r\n   */\r\n  sendMessage(obj, cb) {\r\n    if (this.wsURL) {\r\n      if (this.apiStatus) {\r\n        try {\r\n          this.ws.send(JSON.stringify(obj));\r\n        } catch (e) {\r\n          console.error('[API] Error stringfy message: ', obj, e);\r\n          return;\r\n        }\r\n      } else {\r\n        this.queue.push(obj);\r\n      }\r\n    } else {\r\n      if (this.apiStatus) {\r\n        try {\r\n          window.OverlayPluginApi.callHandler(JSON.stringify(obj), cb);\r\n        } catch (e) {\r\n          console.error('[API] Error stringfy message: ', obj, e);\r\n          return;\r\n        }\r\n      } else {\r\n        this.queue.push({ obj, cb });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Trigger event function, called by OverlayPluginApi, need `this` binding\r\n   * @param {Object} msg - Data from OverlayPluginApi\r\n   */\r\n  triggerEvent(msg) {\r\n    // If this event type has subscribers\r\n    if (this.subscribers[msg.type]) {\r\n      // Trigger all event's callback\r\n      for (let cb of this.subscribers[msg.type]) {\r\n        cb(msg);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add an subscriber\r\n   * @param {String} event - Event which is to subscribe\r\n   * @param {Function} cb - Callback function\r\n   */\r\n  addOverlayListener(event, cb) {\r\n    if (!this.subscribers[event]) {\r\n      this.subscribers[event] = [];\r\n    }\r\n    this.subscribers[event].push(cb);\r\n  }\r\n\r\n  /**\r\n   * Remove an subscriber\r\n   * @param {String} event - Event which is to unsubscribe\r\n   * @param {Function} cb - Callback function\r\n   */\r\n  removeOverlayListener(event, cb) {\r\n    if (this.subscribers[event]) {\r\n      let list = this.subscribers[event];\r\n      let pos = list.indexOf(cb);\r\n      if (pos > -1) {\r\n        list.splice(pos, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start listening events\r\n   * @param {Array} events - Events which to subscribe\r\n   */\r\n  startOverlayEvents(events) {\r\n    this.sendMessage({\r\n      call: 'subscribe',\r\n      events,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * This function allows you to call an overlay handler.\r\n   * These handlers are declared by Event Sources (either built into OverlayPlugin or loaded through addons like Cactbot).\r\n   * @param {Object} msg\r\n   */\r\n  callOverlayHandler(msg) {\r\n    return new Promise((resolve, reject) => {\r\n      this.sendMessage(msg, (data) => {\r\n        try {\r\n          const rd = data == null ? null : JSON.parse(data);\r\n        } catch (e) {\r\n          console.error('[API] Error stringfy message: ', data, e);\r\n          return reject(e);\r\n        }\r\n        return resolve(rd);\r\n      });\r\n    });\r\n  }\r\n}\r\n","'use strict';\r\n\r\nexport default {\r\n  CombatData: null,\r\n  LogLine: null,\r\n  ImportedLogLines: null,\r\n  ChangeZone: null,\r\n  ChangePrimaryPlayer: null,\r\n  OnlineStatusChanged: null,\r\n};\r\n","'use strict';\n\nimport RawAPI from './api.js';\nimport rEvents from './events.js';\n\nexport default class OverlayAPI {\n  /**\n   * Init API\n   * @constructor\n   * @param {String} options - Message queue before OverlayPluginApi is ready\n   * @param {Object} listening - Event types which are being listened and all listeners\n   * @param {API} api - Overlay API\n   */\n  constructor(events = {}) {\n    this.events = Object.assign({}, rEvents, events);\n    this.listening = {};\n    this.api = new RawAPI();\n    // Register all events\n    for (let event in this.events) {\n      let cbs = this.events[event];\n      if (cbs) {\n        this.add(event, cbs);\n      }\n    }\n  }\n\n  /**\n   * Add an event listener\n   * @param {String} event - Event to listen\n   * @param {Function|Array} cbs - Callback function(s)\n   */\n  add(event, cbs) {\n    if (typeof cbs === 'function') {\n      this.api.addOverlayListener(event, cbs);\n      if (!this.listening.hasOwnProperty(event)) {\n        this.listening[event] = [];\n        this.api.startOverlayEvents([event]);\n      }\n      this.listening[event].push(cbs);\n    } else if (Array.isArray(cbs)) {\n      cbs.forEach((f) => {\n        this.api.addOverlayListener(event, f);\n      });\n      if (!this.listening.hasOwnProperty(event)) {\n        this.listening[event] = [];\n        this.api.startOverlayEvents([event]);\n      }\n      this.listening[event].push(...cbs);\n    } else {\n      console.error('[API] Wrong params:', cbs);\n      return;\n    }\n  }\n\n  /**\n   * Remove a listener\n   * @param {String} event - Event type which listener belongs to\n   * @param {Function|Number} id - Function or number which listener to remove\n   */\n  remove(event, id) {\n    // Get cb\n    let cb;\n    if (typeof id === 'function') {\n      cb = id;\n    } else if (typeof id === 'number') {\n      cb = this.listening[event][id];\n      if (cb) {\n        this.listening[event].splice(id, 1);\n      }\n    } else {\n      console.error('[API] Wrong params:', id);\n      return;\n    }\n    // Remove listener\n    if (cb) {\n      this.api.removeOverlayListener(event, cb);\n    }\n  }\n\n  /**\n   * Remove all listener of one event type\n   * @param {String} event - Event type which listener belongs to\n   */\n  removeAll(event) {\n    if (this.listening[event] && this.listening[event].length > 0) {\n      this.listening[event].forEach((cb) => {\n        this.api.removeOverlayListener(event, cb);\n      });\n      this.listening[event] = [];\n    }\n  }\n\n  /**\n   * List all event listeners\n   */\n  list() {\n    console.log(this.listening);\n  }\n\n  /**\n   * This function allows you to call an overlay handler.\n   * These handlers are declared by Event Sources (either built into OverlayPlugin or loaded through addons like Cactbot).\n   * Returns a Promise\n   * @param {Object} msg - Message send to OverlayPlugin\n   */\n  call(msg) {\n    return this.api.callOverlayHandler(msg);\n  }\n}\n"],"names":["RawAPI","constructor","queue","apiStatus","subscribers","wsURL","exec","window","location","href","ws","responsePromises","initWS","initAPI","OverlayPluginApi","ready","setTimeout","__OverlayCallback","triggerEvent","bind","length","obj","cb","shift","callHandler","JSON","stringify","WebSocket","addEventListener","e","console","error","info","msg","sendMessage","parse","data","rseq","undefined","send","push","type","addOverlayListener","event","removeOverlayListener","list","pos","indexOf","splice","startOverlayEvents","events","call","callOverlayHandler","Promise","resolve","reject","rd","CombatData","LogLine","ImportedLogLines","ChangeZone","ChangePrimaryPlayer","OnlineStatusChanged","OverlayAPI","Object","assign","rEvents","listening","api","cbs","add","hasOwnProperty","Array","isArray","forEach","f","remove","id","removeAll","log"],"mappings":"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"}