{"version":3,"file":"index.js","sources":["../src/components/logger.js","../src/components/events.js","../src/components/plugin.js","../src/components/api.js"],"sourcesContent":["export default {\r\n  /**\r\n   * Info logger\r\n   * @param {String} i\r\n   * @param {...any} params\r\n   */\r\n  i(i, ...params) {\r\n    console.info('[OverlayAPI]', i, ...params);\r\n  },\r\n  /**\r\n   * Error logger\r\n   * @param {Object} e\r\n   * @param {...any} params\r\n   */\r\n  e(e, ...params) {\r\n    console.log('[OverlayAPI] Error occurred:', e, ...params);\r\n  },\r\n};\r\n","export default {\r\n  CombatData: null,\r\n  LogLine: null,\r\n  ImportedLogLines: null,\r\n  ChangeZone: null,\r\n  ChangePrimaryPlayer: null,\r\n  OnlineStatusChanged: null,\r\n};\r\n","import logger from './logger';\r\n\r\n/**\r\n * Origin api ported from common.js\r\n * @class\r\n * @prop {String} _queue - Message queue before OverlayPluginApi is ready\r\n * @prop {Boolean} _status - OverlayPluginApi init status\r\n * @prop {String} _wsURL - Web Socket URL if exist\r\n * @prop {Object} _ws - Web Socket instance if exist\r\n * @prop {Object} _resPromises - Web Socket response promises if exist\r\n * @prop {Object} subscribers - All subscribers for events emitted by OverlayPluginApi\r\n */\r\nexport default class PluginAPI {\r\n  /**\r\n   * Init API\r\n   * @constructor\r\n   */\r\n  constructor() {\r\n    this._queue = []; // { msg, cb } | msg\r\n    this._status = false;\r\n    this.subscribers = {}; // { eventName: [callbackFunc] }\r\n    // Check if in WebSocket mode\r\n    this._wsURL = /[?&]OVERLAY_WS=([^&]+)/.exec(window.location.href);\r\n    if (this._wsURL) {\r\n      this._ws = null;\r\n      this._resPromises = {};\r\n      this.initWS();\r\n    } else {\r\n      this.initAPI();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Init OverlayPluginApi connection\r\n   */\r\n  initAPI() {\r\n    if (!window.OverlayPluginApi || !window.OverlayPluginApi.ready) {\r\n      setTimeout(this.initAPI, 200);\r\n      return;\r\n    }\r\n    // API loaded\r\n    this._status = true;\r\n    // Bind `this` for callback function called by OverlayAPI, otherwist it will turn to `undefined`\r\n    window.__OverlayCallback = this.triggerEvents.bind(this);\r\n    // Send all messages in queue to OverlayPluginApi\r\n    while (this._queue.length > 0) {\r\n      let { msg, cb } = this._queue.shift();\r\n      try {\r\n        window.OverlayPluginApi.callHandler(JSON.stringify(msg), cb);\r\n      } catch (e) {\r\n        logger.e(e, msg);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Init WebSocket connection\r\n   */\r\n  initWS() {\r\n    this._ws = new WebSocket(this._wsURL[1]);\r\n    // Log error\r\n    this._ws.addEventListener('error', (e) => {\r\n      logger.e(e);\r\n    });\r\n    // Successfully connected WebSocket\r\n    this._ws.addEventListener('open', () => {\r\n      logger.i('WebSocket connected');\r\n      this._status = true;\r\n      while (this._queue.length > 0) {\r\n        let msg = this._queue.shift();\r\n        this.sendMessage(msg);\r\n      }\r\n    });\r\n    // On message loaded from WebSocket\r\n    this._ws.addEventListener('message', (msg) => {\r\n      try {\r\n        msg = JSON.parse(msg.data);\r\n      } catch (e) {\r\n        logger.e(e, msg);\r\n        return;\r\n      }\r\n      if (msg.rseq !== undefined && this._resPromises[msg.rseq]) {\r\n        this._resPromises[msg.rseq](msg);\r\n        delete this._resPromises[msg.rseq];\r\n      } else {\r\n        this.triggerEvents(msg);\r\n      }\r\n    });\r\n    // Connection failed\r\n    this._ws.addEventListener('close', () => {\r\n      this._status = false;\r\n      logger.i('WebSocket trying to reconnect...');\r\n      // Don't spam the server with retries\r\n      setTimeout(() => {\r\n        this.initWS();\r\n      }, 200);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Send message to OverlayPluginApi or push into queue before its init\r\n   * @param {Object} msg - Object to send\r\n   * @param {Function} cb - Callback function\r\n   */\r\n  sendMessage(msg, cb) {\r\n    if (this._wsURL) {\r\n      if (this._status) {\r\n        try {\r\n          this._ws.send(JSON.stringify(msg));\r\n        } catch (e) {\r\n          logger.e(e, msg);\r\n          return;\r\n        }\r\n      } else {\r\n        this._queue.push(msg);\r\n      }\r\n    } else {\r\n      if (this._status) {\r\n        try {\r\n          window.OverlayPluginApi.callHandler(JSON.stringify(msg), cb);\r\n        } catch (e) {\r\n          logger.e(e, msg);\r\n          return;\r\n        }\r\n      } else {\r\n        this._queue.push({ msg, cb });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start listening event\r\n   * @param {String} event - Event which to subscribe\r\n   */\r\n  listenEvent(event) {\r\n    this.sendMessage({\r\n      call: 'subscribe',\r\n      events: [event],\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Trigger event function, called by OverlayPluginApi, need `this` binding\r\n   * @param {Object} msg - Data from OverlayPluginApi\r\n   */\r\n  triggerEvents(msg) {\r\n    // If this event type has subscribers\r\n    if (this.subscribers[msg.type]) {\r\n      // Trigger all event's callback\r\n      for (let cb of this.subscribers[msg.type]) {\r\n        cb(msg);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import logger from './logger';\r\nimport ev from './events.js';\r\nimport PluginAPI from './plugin.js';\r\n\r\n/**\r\n * Public API class\r\n * @class\r\n * @extends PluginAPI\r\n * @prop {String} _events - Events needs to be init at construct\r\n * @extends @prop {Object} subscribers - All subscribers for events emitted by OverlayPluginApi\r\n */\r\nexport default class OverlayAPI extends PluginAPI {\r\n  /**\r\n   * Init API\r\n   * @constructor\r\n   * @param {Object} events - Events needs to be init at construct\r\n   */\r\n  constructor(events = {}) {\r\n    super();\r\n    this._events = Object.assign({}, ev, events);\r\n    // Register all events\r\n    for (let event in this._events) {\r\n      let cbs = this._events[event];\r\n      if (cbs) {\r\n        this.add(event, cbs);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add an event listener\r\n   * @param {String} event - Event to listen\r\n   * @param {Function|Array} cbs - Callback function(s)\r\n   */\r\n  add(event, cbs) {\r\n    const eventListened = this.subscribers.hasOwnProperty(event);\r\n    // Init event array\r\n    if (!eventListened) {\r\n      this.subscribers[event] = [];\r\n    }\r\n    // Push events\r\n    if (typeof cbs === 'function') {\r\n      this.subscribers[event].push(cbs);\r\n    } else if (Array.isArray(cbs)) {\r\n      cbs.forEach((f) => {\r\n        this.subscribers[event].push(f);\r\n      });\r\n    } else {\r\n      logger.e('Wrong event callbacks', cbs);\r\n      return;\r\n    }\r\n    // Listen event type\r\n    if (!eventListened) {\r\n      this.listenEvent(event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove a listener\r\n   * @param {String} event - Event type which listener belongs to\r\n   * @param {Function|Number} cb - Function or number which listener to remove\r\n   */\r\n  remove(event, cb) {\r\n    const eventListened = this.subscribers.hasOwnProperty(event);\r\n    if (eventListened) {\r\n      // Get cb\r\n      let cb;\r\n      if (typeof cb === 'function') {\r\n        let cbPos = this.subscribers[event].indexOf(cb);\r\n        if (cbPos >= 0) {\r\n          this.subscribers[event].splice(cbPos, 1);\r\n        }\r\n      } else if (typeof cb === 'number') {\r\n        cb = this.subscribers[event][cb];\r\n        if (cb) {\r\n          this.subscribers[event].splice(cb, 1);\r\n        }\r\n      } else {\r\n        logger.e('Wrong params', cb);\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove all listener of one event type\r\n   * @param {String} event - Event type which listener belongs to\r\n   */\r\n  removeAll(event) {\r\n    if (this.subscribers[event] && this.subscribers[event].length > 0) {\r\n      this.subscribers[event] = [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all listeners of a event\r\n   * @param {String} event - Event type which listener belongs to\r\n   */\r\n  list(event) {\r\n    return this.subscribers[event] ? this.subscribers[event] : [];\r\n  }\r\n\r\n  /**\r\n   * This function allows you to call an overlay handler.\r\n   * These handlers are declared by Event Sources (either built into OverlayPlugin or loaded through addons like Cactbot).\r\n   * Returns a Promise\r\n   * @param {Object} msg - Message send to OverlayPlugin\r\n   */\r\n  call(msg) {\r\n    return new Promise((resolve, reject) => {\r\n      this.sendMessage(msg, (data) => {\r\n        let rd;\r\n        try {\r\n          rd = data == null ? null : JSON.parse(data);\r\n        } catch (e) {\r\n          logger.e(e, data);\r\n          return reject(e);\r\n        }\r\n        return resolve(rd);\r\n      });\r\n    });\r\n  }\r\n}\r\n"],"names":["i","params","console","info","e","log","CombatData","LogLine","ImportedLogLines","ChangeZone","ChangePrimaryPlayer","OnlineStatusChanged","PluginAPI","constructor","_queue","_status","subscribers","_wsURL","exec","window","location","href","_ws","_resPromises","initWS","initAPI","OverlayPluginApi","ready","setTimeout","__OverlayCallback","triggerEvents","bind","length","msg","cb","shift","callHandler","JSON","stringify","logger","WebSocket","addEventListener","sendMessage","parse","data","rseq","undefined","send","push","listenEvent","event","call","events","type","OverlayAPI","_events","Object","assign","ev","cbs","add","eventListened","hasOwnProperty","Array","isArray","forEach","f","remove","cbPos","indexOf","splice","removeAll","list","Promise","resolve","reject","rd"],"mappings":"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"}